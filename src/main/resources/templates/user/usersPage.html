<!DOCTYPE html>
<html lang="en"
      xmlns:layout="http://www.ultraq.net.nz/thymeleaf/layout"
      layout:decorate="template/layout.html">
<body>
<div layout:fragment="content">
    <!-- Responsive Table -->
    <div class="d-flex flex-row justify-content-center align-items-center">
        <h4 class="fw-bold pt-3">Пользователи</h4>
    </div>
    <div class="card">
        <div class="card-header py-2 d-flex align-items-center">
            <div class="d-flex justify-content-end flex-grow-1 m-lg-2">
                <div class="search-input-wrapper col-md-4">
                    <label class="d-flex align-items-center gap-2 w-100">
                        Search:
                        <input type="text" id="search" class="form-control" placeholder="Search...">
                    </label>
                </div>
            </div>
            <div class="d-flex ms-auto">
                <button class="btn btn-primary"
                        id="createEntity"
                        data-bs-toggle="modal" data-bs-target="#editAdminUser">
                    <i class="ti ti-plus"></i>
                </button>
            </div>
        </div>

        <div class="card-body">
            <div>
                <div class="table-responsive">
                    <table class="table table-striped table-hover">
                        <thead>
                        <tr id="table-head">
                            <td class="text-center">ID</td>
                            <td class="text-center">Имя фамилия</td>
                            <td class="text-center">Почта</td>
                            <td class="text-center">Права</td>
                            <td class="text-center">Actions</td>
                        </tr>
                        </thead>
                        <tbody id="table-body"></tbody>
                    </table>
                </div>
            </div>
        </div>

        <div class="card-footer d-flex justify-content-between align-items-center pb-0">
            <label class="d-flex align-items-center gap-1" style="transform: translateY(-8px);">
                Показать:
                <select id="pageSize" class="form-control">
                    <option value="5" selected>5</option>
                    <option value="10">10</option>
                    <option value="20">20</option>
                </select>
            </label>
            <nav aria-label="Page navigation">
                <ul class="pagination" id="pagination">
                </ul>
            </nav>
        </div>

        <script>
            document.addEventListener('DOMContentLoaded', () => {
                const tableBody = document.getElementById('table-body');
                const pageSizeSelect = document.getElementById('pageSize');
                const pagination = document.getElementById('pagination');

                let currentPage = 0;
                let pageSize = parseInt(pageSizeSelect.value, 10);

                // Функция для загрузки данных администраторов
                async function fetchAdminUsers(page = 0, size = 5) {
                    try {
                        const response = await fetch(`admin/getAll?page=${page}&size=${size}`);
                        if (!response.ok) {
                            throw new Error('Ошибка загрузки данных');
                        }

                        const data = await response.json();
                        console.log(data);
                        console.log(data.content);
                        populateTable(data.content);

                        updatePagination(data.totalPages, page);
                    } catch (error) {
                        console.error('Ошибка:', error);
                    }
                }

                // Функция для заполнения таблицы
                function populateTable(users) {
                    tableBody.innerHTML = ''; // Очистка таблицы

                    console.log('users:', users);
                    if (users.length === 0) {
                        const row = document.createElement('tr');
                        const cell = document.createElement('td');
                        cell.colSpan = 5;
                        cell.className = 'text-center';
                        cell.textContent = 'Нет данных для отображения';
                        row.appendChild(cell);
                        tableBody.appendChild(row);
                        return;
                    }

                    users.forEach(user => {
                        const row = document.createElement('tr');

                        const idCell = document.createElement('td');
                        idCell.className = 'text-center';
                        idCell.textContent = user.id;
                        row.appendChild(idCell);

                        const nameCell = document.createElement('td');
                        nameCell.className = 'text-center';
                        nameCell.textContent = user.name+' '+user.surname;
                        row.appendChild(nameCell);

                        const emailCell = document.createElement('td');
                        emailCell.className = 'text-center';
                        emailCell.textContent = user.email;
                        row.appendChild(emailCell);

                        const rightsCell = document.createElement('td');
                        rightsCell.className = 'text-center';
                        rightsCell.textContent = user.role; // Пример: объединяем роли
                        row.appendChild(rightsCell);

                        const actionsCell = document.createElement('td');
                        actionsCell.className = 'text-center';
                        const editButton = document.createElement('button');
                        editButton.className = 'btn btn-sm btn-primary';
                        editButton.textContent = 'Edit';
                        editButton.onclick = () => editUser(user.id);
                        actionsCell.appendChild(editButton);

                        const deleteButton = document.createElement('button');
                        deleteButton.className = 'btn btn-sm btn-danger ms-2';
                        deleteButton.textContent = 'Delete';
                        deleteButton.onclick = () => deleteUser(user.id);
                        actionsCell.appendChild(deleteButton);

                        row.appendChild(actionsCell);
                        tableBody.appendChild(row);
                    });
                }

                // Функция для обновления пагинации
                function updatePagination(totalPages, currentPage) {
                    pagination.innerHTML = ''; // Очистка пагинации

                    for (let i = 0; i < totalPages; i++) {
                        const pageItem = document.createElement('li');
                        pageItem.className = `page-item ${i === currentPage ? 'active' : ''}`;
                        const pageLink = document.createElement('a');
                        pageLink.className = 'page-link';
                        pageLink.textContent = i + 1;
                        pageLink.href = '#';
                        pageLink.onclick = (e) => {
                            e.preventDefault();
                            changePage(i);
                        };

                        pageItem.appendChild(pageLink);
                        pagination.appendChild(pageItem);
                    }
                }

                // Функция для изменения текущей страницы
                function changePage(newPage) {
                    currentPage = newPage;
                    fetchAdminUsers(currentPage, pageSize);
                }

                // Обработчик изменения размера страницы
                pageSizeSelect.addEventListener('change', () => {
                    pageSize = parseInt(pageSizeSelect.value, 10);
                    currentPage = 0; // Сбрасываем на первую страницу
                    fetchAdminUsers(currentPage, pageSize);
                });

                // Пример обработки кнопок
                function editUser(userId) {
                    console.log('Edit user:', userId);
                    // Логика редактирования пользователя
                }

                function deleteUser(userId) {
                    console.log('Delete user:', userId);
                    // Логика удаления пользователя
                }

                // Инициализация данных
                fetchAdminUsers(currentPage, pageSize);
            });

        </script>

        <div class="modal fade" id="editAdminUser" tabindex="-1" aria-hidden="true">
            <div class="modal-dialog modal-lg modal-simple modal-edit-admin-user">
                <div class="modal-content p-3 p-md-5">
                    <div class="modal-body">
                        <button type="button" class="btn-close" data-bs-dismiss="modal" aria-label="Close"></button>
                        <div class="text-center mb-4">
                            <h3 class="mb-2">Редактировать Администратора</h3>
                            <p class="text-muted">Обновление информации администратора.</p>
                        </div>
                        <form id="editAdminUserForm" class="row g-3" onsubmit="return false">
                            <!-- Имя -->
                            <div class="col-12 col-md-6">
                                <label class="form-label" for="adminUserName">Имя</label>
                                <input
                                        type="text"
                                        id="adminUserName"
                                        name="name"
                                        class="form-control"
                                        placeholder="Иван"
                                        required
                                />
                            </div>

                            <!-- Фамилия -->
                            <div class="col-12 col-md-6">
                                <label class="form-label" for="adminUserSurname">Фамилия</label>
                                <input
                                        type="text"
                                        id="adminUserSurname"
                                        name="surname"
                                        class="form-control"
                                        placeholder="Иванов"
                                        required
                                />
                            </div>

                            <!-- Электронная почта -->
                            <div class="col-12 col-md-6">
                                <label class="form-label" for="adminUserEmail">Электронная почта</label>
                                <input
                                        type="email"
                                        id="adminUserEmail"
                                        name="email"
                                        class="form-control"
                                        placeholder="example@domain.com"
                                        required
                                />
                            </div>

                            <!-- Номер телефона -->
                            <div class="col-12 col-md-6">
                                <label class="form-label" for="adminUserPhone">Номер телефона</label>
                                <div class="input-group">
                                    <span class="input-group-text">+7</span>
                                    <input
                                            type="text"
                                            id="adminUserPhone"
                                            name="phoneNumber"
                                            class="form-control phone-number-mask"
                                            placeholder="999 999 9999"
                                            required
                                    />
                                </div>
                            </div>

                            <!-- Пароль -->
                            <div class="col-12 col-md-6">
                                <label class="form-label" for="adminUserPassword">Пароль</label>
                                <input
                                        type="password"
                                        id="adminUserPassword"
                                        name="password"
                                        class="form-control"
                                        placeholder="••••••••"
                                        required
                                />
                            </div>

                            <!-- Роль -->
                            <div class="col-12 col-md-6">
                                <label class="form-label" for="adminUserRole">Роль</label>
                                <select
                                        id="adminUserRole"
                                        name="role"
                                        class="form-select"
                                        required
                                >
                                    <option value="" disabled selected>Выберите роль</option>
                                    <option value="ADMIN">Администратор</option>
                                    <option value="SUPER_ADMIN">Супер Администратор</option>
                                    <option value="MODERATOR">Модератор</option>
                                    <!-- Добавьте другие роли по необходимости -->
                                </select>
                            </div>

                            <!-- Активен -->
                            <div class="col-12">
                                <label class="switch">
                                    <input
                                            type="checkbox"
                                            id="adminUserIsActive"
                                            name="isActive"
                                            class="switch-input"
                                            checked
                                    />
                                    <span class="switch-toggle-slider">
                                <span class="switch-on"></span>
                                <span class="switch-off"></span>
                            </span>
                                    <span class="switch-label">Активен</span>
                                </label>
                            </div>

                            <!-- Кнопки отправки и отмены -->
                            <div class="col-12 text-center">
                                <button type="submit" class="btn btn-primary me-sm-3 me-1">Сохранить</button>
                                <button
                                        type="reset"
                                        class="btn btn-label-secondary"
                                        data-bs-dismiss="modal"
                                        aria-label="Закрыть"
                                >
                                    Отменить
                                </button>
                            </div>
                        </form>
                    </div>
                </div>
            </div>
        </div>

        <div class="modal fade" id="deleteConfirmModal" tabindex="-1" aria-hidden="true">
            <div class="modal-dialog" role="document">
                <div class="modal-content">
                    <div class="modal-header">
                        <h5 class="modal-title" id="deleteConfirmModalLabel">Confirm Deletion</h5>
                        <button type="button" class="btn-close" data-bs-dismiss="modal" aria-label="Close"></button>
                    </div>
                    <div class="modal-body">
                        Вы уверены, что хотите удалить этот элемент?
                    </div>
                    <div class="modal-footer">
                        <button type="button" class="btn btn-label-secondary" data-bs-dismiss="modal">Cancel</button>
                        <button type="button" class="btn btn-danger" id="confirm-delete-btn">Delete</button>
                    </div>
                </div>
            </div>
        </div>


    </div>
    <script th:replace="~{user/scripts::scripts}"></script>
    <script>
        $(document).ready(function () {

        });
    </script>

</div>
</body>


</html>